#!/bin/sh

ping -q -c 1 1.1.1.1 >/dev/null 2>&1 || {
	notify-send "‚ùå Error, you are offline." "Check your internet connection."
	exit 1
}

package=$(pacman -Quq | wc -l)

[ "$package" -eq 0 ] && {
	notify-send "There is nothing to update."
	exit
}

m() { ${DMENU-:dmenu} "$@"; }

while
	choice="$(printf "Yes\nNo\nShow changes" | m -p "Update packages?")"
	[ "$choice" = 'Show changes' ]
do
	pacman -Qu | m
done

[ ! "$choice" ] || [ "$choice" = 'No' ] && exit

notify-send "üîΩ Updating..."
if sudo pacman --noconfirm -Syu; then
	notify-send "‚úÖ Updating completed!" "$package packages have been updated."
else
	notify-send -u critical "‚ùå Error downloading updates." \
		"Check your internet connection or run update manually to see errors."
	exit 1
fi
